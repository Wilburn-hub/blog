# ç³»ç»Ÿç›‘æ§æŒ‡å—

## ç›®å½•
- [ç›‘æ§æ¶æ„](#ç›‘æ§æ¶æ„)
- [ç›‘æ§æŒ‡æ ‡](#ç›‘æ§æŒ‡æ ‡)
- [ç›‘æ§å·¥å…·](#ç›‘æ§å·¥å…·)
- [å‘Šè­¦é…ç½®](#å‘Šè­¦é…ç½®)
- [æ€§èƒ½è°ƒä¼˜](#æ€§èƒ½è°ƒä¼˜)
- [æ—¥å¿—ç®¡ç†](#æ—¥å¿—ç®¡ç†)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

## ç›‘æ§æ¶æ„

### ç›‘æ§å±‚çº§
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç›‘æ§å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Uptime    â”‚  â”‚  Pingdom    â”‚  â”‚  GTmetrix   â”‚        â”‚
â”‚  â”‚   Robot     â”‚  â”‚  Monitor    â”‚  â”‚   Pagespeed â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨ç›‘æ§å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Health    â”‚  â”‚   Metrics   â”‚  â”‚   Tracing   â”‚        â”‚
â”‚  â”‚   Checks    â”‚  â”‚  Collection â”‚  â”‚   System    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŸºç¡€è®¾æ–½ç›‘æ§å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚     CPU     â”‚  â”‚   Memory    â”‚  â”‚    Disk     â”‚        â”‚
â”‚  â”‚   Monitor   â”‚  â”‚   Monitor   â”‚  â”‚   Monitor   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘
```
Application â†’ Metrics Collector â†’ Time Series Database â†’ Alerting â†’ Dashboard
     â†“               â†“                    â†“              â†“          â†“
   Logs â†’ Log Aggregator â†’ Log Storage â†’ Analysis â†’ Visualization
```

## ç›‘æ§æŒ‡æ ‡

### åº”ç”¨å±‚æŒ‡æ ‡

#### åŸºç¡€æŒ‡æ ‡
- **å“åº”æ—¶é—´** (Response Time)
  - å¹³å‡å“åº”æ—¶é—´
  - 95thç™¾åˆ†ä½å“åº”æ—¶é—´
  - 99thç™¾åˆ†ä½å“åº”æ—¶é—´
  - ç›®æ ‡: < 200ms (å¹³å‡), < 500ms (95th)

- **ååé‡** (Throughput)
  - æ¯ç§’è¯·æ±‚æ•° (RPS)
  - æ¯åˆ†é’Ÿæ´»è·ƒç”¨æˆ·æ•°
  - ç›®æ ‡: > 100 RPS

- **é”™è¯¯ç‡** (Error Rate)
  - HTTPé”™è¯¯ç‡ (4xx, 5xx)
  - åº”ç”¨é”™è¯¯ç‡
  - ç›®æ ‡: < 1%

- **å¯ç”¨æ€§** (Availability)
  - æœåŠ¡å¯ç”¨æ€§ç™¾åˆ†æ¯”
  - å¥åº·æ£€æŸ¥é€šè¿‡ç‡
  - ç›®æ ‡: > 99.9%

#### ä¸šåŠ¡æŒ‡æ ‡
- é¡µé¢æµè§ˆé‡
- ç”¨æˆ·æ³¨å†Œæ•°
- æ–‡ç« å‘å¸ƒæ•°
- è¯„è®ºæ•°é‡

### ç³»ç»Ÿå±‚æŒ‡æ ‡

#### CPUæŒ‡æ ‡
```bash
# æŸ¥çœ‹CPUä½¿ç”¨ç‡
top
htop
mpstat 1

# ç›‘æ§æŒ‡æ ‡
- CPUä½¿ç”¨ç‡ (%)
- CPUç­‰å¾…æ—¶é—´ (%)
- ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°
- è¿è¡Œé˜Ÿåˆ—é•¿åº¦
```

#### å†…å­˜æŒ‡æ ‡
```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h
vmstat 1

# ç›‘æ§æŒ‡æ ‡
- å†…å­˜ä½¿ç”¨ç‡ (%)
- å¯ç”¨å†…å­˜ (GB)
- äº¤æ¢åˆ†åŒºä½¿ç”¨ç‡ (%)
- ç¼“å­˜å‘½ä¸­ç‡ (%)
```

#### ç£ç›˜æŒ‡æ ‡
```bash
# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h
iostat 1

# ç›‘æ§æŒ‡æ ‡
- ç£ç›˜ä½¿ç”¨ç‡ (%)
- ç£ç›˜IOPS
- ç£ç›˜ååé‡ (MB/s)
- I/Oç­‰å¾…æ—¶é—´ (%)
```

#### ç½‘ç»œæŒ‡æ ‡
```bash
# æŸ¥çœ‹ç½‘ç»œçŠ¶æ€
iftop
netstat -i
ss -s

# ç›‘æ§æŒ‡æ ‡
- ç½‘ç»œå¸¦å®½ä½¿ç”¨ç‡
- è¿æ¥æ•°
- ç½‘ç»œå»¶è¿Ÿ (ms)
- ä¸¢åŒ…ç‡ (%)
```

### æ•°æ®åº“æŒ‡æ ‡

#### PostgreSQLæŒ‡æ ‡
```sql
-- è¿æ¥æ•°ç›‘æ§
SELECT count(*) FROM pg_stat_activity;

-- æ…¢æŸ¥è¯¢ç›‘æ§
SELECT query, mean_time, calls
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;

-- æ•°æ®åº“å¤§å°
SELECT pg_size_pretty(pg_database_size('personal_blog'));

-- è¡¨å¤§å°
SELECT schemaname, tablename,
       pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size
FROM pg_tables
WHERE schemaname = 'public';
```

#### RedisæŒ‡æ ‡
```bash
# Redisä¿¡æ¯
redis-cli info

# å…³é”®æŒ‡æ ‡
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- é”®ç©ºé—´ç»Ÿè®¡
- å‘½ä»¤æ‰§è¡Œç»Ÿè®¡
- è¿æ¥æ•°
- å‘½ä¸­ç‡
```

## ç›‘æ§å·¥å…·

### å†…ç½®ç›‘æ§è„šæœ¬

#### åº”ç”¨ç›‘æ§è„šæœ¬
```bash
#!/bin/bash
# scripts/monitoring/app-monitor.sh

# æ£€æŸ¥åº”ç”¨å¥åº·çŠ¶æ€
check_app_health() {
    local url="http://localhost:3000/api/health"
    local response=$(curl -s -w "%{http_code}" "$url")
    local http_code="${response: -3}"
    local body="${response%???}"

    if [[ "$http_code" == "200" ]]; then
        echo "âœ… åº”ç”¨å¥åº·æ£€æŸ¥é€šè¿‡"
        return 0
    else
        echo "âŒ åº”ç”¨å¥åº·æ£€æŸ¥å¤±è´¥ (HTTP $http_code)"
        return 1
    fi
}

# æ£€æŸ¥å“åº”æ—¶é—´
check_response_time() {
    local url="http://localhost:3000"
    local response_time=$(curl -o /dev/null -s -w "%{time_total}" "$url")

    if (( $(echo "$response_time < 0.5" | bc -l) )); then
        echo "âœ… å“åº”æ—¶é—´æ­£å¸¸: ${response_time}s"
        return 0
    else
        echo "âš ï¸  å“åº”æ—¶é—´è¾ƒæ…¢: ${response_time}s"
        return 1
    fi
}

# æ£€æŸ¥é”™è¯¯ç‡
check_error_rate() {
    local log_file="/app/logs/app.log"
    local recent_errors=$(tail -n 100 "$log_file" | grep -c "ERROR")

    if [[ $recent_errors -lt 5 ]]; then
        echo "âœ… é”™è¯¯ç‡æ­£å¸¸: $recent_errors/100"
        return 0
    else
        echo "âš ï¸  é”™è¯¯ç‡è¾ƒé«˜: $recent_errors/100"
        return 1
    fi
}

# ä¸»ç›‘æ§å‡½æ•°
main() {
    echo "=== åº”ç”¨ç›‘æ§æ£€æŸ¥ $(date) ==="

    local failed_checks=0

    check_app_health || failed_checks=$((failed_checks + 1))
    check_response_time || failed_checks=$((failed_checks + 1))
    check_error_rate || failed_checks=$((failed_checks + 1))

    if [[ $failed_checks -eq 0 ]]; then
        echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡"
        return 0
    else
        echo "âŒ $failed_checks é¡¹æ£€æŸ¥å¤±è´¥"
        return 1
    fi
}

main "$@"
```

#### æ•°æ®åº“ç›‘æ§è„šæœ¬
```bash
#!/bin/bash
# scripts/monitoring/db-monitor.sh

# PostgreSQLç›‘æ§
check_postgres() {
    local container_name="personal-blog_db_1"

    # æ£€æŸ¥è¿æ¥
    if docker exec "$container_name" pg_isready -U postgres >/dev/null 2>&1; then
        echo "âœ… PostgreSQLè¿æ¥æ­£å¸¸"
    else
        echo "âŒ PostgreSQLè¿æ¥å¤±è´¥"
        return 1
    fi

    # æ£€æŸ¥è¿æ¥æ•°
    local connections=$(docker exec "$container_name" psql -U postgres -t -c "SELECT count(*) FROM pg_stat_activity;")
    if [[ $connections -lt 100 ]]; then
        echo "âœ… è¿æ¥æ•°æ­£å¸¸: $connections"
    else
        echo "âš ï¸  è¿æ¥æ•°è¾ƒé«˜: $connections"
    fi

    # æ£€æŸ¥æ•°æ®åº“å¤§å°
    local db_size=$(docker exec "$container_name" psql -U postgres -t -c "SELECT pg_size_pretty(pg_database_size('personal_blog'));")
    echo "ğŸ“Š æ•°æ®åº“å¤§å°: $db_size"
}

# Redisç›‘æ§
check_redis() {
    local container_name="personal-blog_redis_1"

    # æ£€æŸ¥è¿æ¥
    if docker exec "$container_name" redis-cli ping >/dev/null 2>&1; then
        echo "âœ… Redisè¿æ¥æ­£å¸¸"
    else
        echo "âŒ Redisè¿æ¥å¤±è´¥"
        return 1
    fi

    # æ£€æŸ¥å†…å­˜ä½¿ç”¨
    local memory=$(docker exec "$container_name" redis-cli info memory | grep used_memory_human | cut -d: -f2 | tr -d '\r')
    echo "ğŸ“Š Rediså†…å­˜ä½¿ç”¨: $memory"

    # æ£€æŸ¥é”®æ•°é‡
    local keys=$(docker exec "$container_name" redis-cli dbsize)
    echo "ğŸ”‘ Redisé”®æ•°é‡: $keys"
}

main() {
    echo "=== æ•°æ®åº“ç›‘æ§æ£€æŸ¥ $(date) ==="

    check_postgres
    check_redis
}

main "$@"
```

### å¤–éƒ¨ç›‘æ§å·¥å…·

#### Prometheus + Grafana (æ¨è)
```yaml
# docker-compose.monitoring.yml
version: '3.8'

services:
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3001:3000"
    volumes:
      - grafana_data:/var/lib/grafana
      - ./monitoring/grafana/dashboards:/etc/grafana/provisioning/dashboards
      - ./monitoring/grafana/datasources:/etc/grafana/provisioning/datasources
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin

  node-exporter:
    image: prom/node-exporter:latest
    ports:
      - "9100:9100"
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - '--path.procfs=/host/proc'
      - '--path.rootfs=/rootfs'
      - '--path.sysfs=/host/sys'
      - '--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'

volumes:
  prometheus_data:
  grafana_data:
```

#### Uptime Robot (å…è´¹)
- ç›‘æ§ç½‘ç«™å¯ç”¨æ€§
- HTTPçŠ¶æ€ç æ£€æŸ¥
- å“åº”æ—¶é—´ç›‘æ§
- å‘Šè­¦é€šçŸ¥

#### Google Analytics
- ç”¨æˆ·è¡Œä¸ºåˆ†æ
- é¡µé¢æ€§èƒ½ç›‘æ§
- æµé‡æ¥æºåˆ†æ
- å®æ—¶ç”¨æˆ·ç›‘æ§

## å‘Šè­¦é…ç½®

### å‘Šè­¦è§„åˆ™

#### ç³»ç»Ÿå‘Šè­¦è§„åˆ™
```yaml
# monitoring/alerts.yml
groups:
  - name: system
    rules:
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "CPUä½¿ç”¨ç‡è¿‡é«˜"
          description: "å®ä¾‹ {{ $labels.instance }} CPUä½¿ç”¨ç‡ {{ $value }}%"

      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 90
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "å®ä¾‹ {{ $labels.instance }} å†…å­˜ä½¿ç”¨ç‡ {{ $value }}%"

      - alert: DiskSpaceLow
        expr: (node_filesystem_avail_bytes / node_filesystem_size_bytes) * 100 < 10
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ç£ç›˜ç©ºé—´ä¸è¶³"
          description: "å®ä¾‹ {{ $labels.instance }} ç£ç›˜ç©ºé—´å‰©ä½™ {{ $value }}%"
```

#### åº”ç”¨å‘Šè­¦è§„åˆ™
```yaml
  - name: application
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) * 100 > 5
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "åº”ç”¨é”™è¯¯ç‡è¿‡é«˜"
          description: "é”™è¯¯ç‡ {{ $value }}%"

      - alert: HighResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "å“åº”æ—¶é—´è¿‡é•¿"
          description: "95thç™¾åˆ†ä½å“åº”æ—¶é—´ {{ $value }}s"

      - alert: ServiceDown
        expr: up{job="personal-blog"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "æœåŠ¡ä¸å¯ç”¨"
          description: "æœåŠ¡ {{ $labels.instance }} å·²åœæ­¢è¿è¡Œ"
```

### é€šçŸ¥æ¸ é“

#### Slacké€šçŸ¥
```bash
# å‘é€Slacké€šçŸ¥
send_slack_alert() {
    local message="$1"
    local webhook_url="${SLACK_WEBHOOK_URL}"

    curl -X POST "$webhook_url" \
        -H 'Content-Type: application/json' \
        -d "{\"text\":\"$message\"}"
}
```

#### é‚®ä»¶é€šçŸ¥
```bash
# å‘é€é‚®ä»¶é€šçŸ¥
send_email_alert() {
    local subject="$1"
    local message="$2"
    local recipient="${ADMIN_EMAIL}"

    echo "$message" | mail -s "$subject" "$recipient"
}
```

#### çŸ­ä¿¡é€šçŸ¥ (å¯é€‰)
```bash
# å‘é€çŸ­ä¿¡é€šçŸ¥ (éœ€è¦çŸ­ä¿¡æœåŠ¡API)
send_sms_alert() {
    local message="$1"
    local phone="${ADMIN_PHONE}"

    # è°ƒç”¨çŸ­ä¿¡æœåŠ¡API
    curl -X POST "https://sms-api.example.com/send" \
        -d "phone=$phone" \
        -d "message=$message"
}
```

## æ€§èƒ½è°ƒä¼˜

### æ•°æ®åº“ä¼˜åŒ–

#### PostgreSQLä¼˜åŒ–
```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT query, mean_time, calls, total_time
FROM pg_stat_statements
WHERE mean_time > 100
ORDER BY mean_time DESC;

-- åˆ›å»ºç´¢å¼•
CREATE INDEX CONCURRENTLY idx_posts_created_at ON posts(created_at);
CREATE INDEX CONCURRENTLY idx_posts_published ON posts(published) WHERE published = true;

-- æ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE;

-- é‡å»ºç´¢å¼•
REINDEX INDEX CONCURRENTLY idx_posts_created_at;

-- é…ç½®å‚æ•°ä¼˜åŒ–
-- postgresql.conf
shared_buffers = 256MB
effective_cache_size = 1GB
maintenance_work_mem = 64MB
checkpoint_completion_target = 0.9
wal_buffers = 16MB
default_statistics_target = 100
random_page_cost = 1.1
effective_io_concurrency = 200
```

#### Redisä¼˜åŒ–
```bash
# Redisé…ç½®ä¼˜åŒ–
redis.conf:

# å†…å­˜ä¼˜åŒ–
maxmemory 512mb
maxmemory-policy allkeys-lru

# æŒä¹…åŒ–ä¼˜åŒ–
save 900 1
save 300 10
save 60 10000

# ç½‘ç»œä¼˜åŒ–
tcp-keepalive 300
timeout 0

# å®‰å…¨ä¼˜åŒ–
requirepass your_redis_password
```

### åº”ç”¨ä¼˜åŒ–

#### Node.jsä¼˜åŒ–
```javascript
// ç¯å¢ƒå˜é‡ä¼˜åŒ–
process.env.NODE_OPTIONS = '--max-old-space-size=2048';

// è¿æ¥æ± ä¼˜åŒ–
const pool = new Pool({
  max: 20,
  min: 5,
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 2000,
});

// ç¼“å­˜ä¼˜åŒ–
const cacheOptions = {
  max: 100,
  ttl: 1000 * 60 * 5, // 5åˆ†é’Ÿ
};
```

#### Nginxä¼˜åŒ–
```nginx
# æ€§èƒ½ä¼˜åŒ–é…ç½®
worker_processes auto;
worker_connections 1024;

# å¯ç”¨gzipå‹ç¼©
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

# ç¼“å­˜é…ç½®
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# è¿æ¥ä¼˜åŒ–
keepalive_timeout 65;
keepalive_requests 100;

# ç¼“å†²åŒºä¼˜åŒ–
client_body_buffer_size 128k;
client_max_body_size 10m;
client_header_buffer_size 1k;
large_client_header_buffers 4 4k;
```

## æ—¥å¿—ç®¡ç†

### æ—¥å¿—é…ç½®

#### åº”ç”¨æ—¥å¿—
```javascript
// winstonæ—¥å¿—é…ç½®
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
  ],
});

if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.simple()
  }));
}
```

#### Nginxæ—¥å¿—
```nginx
# æ—¥å¿—æ ¼å¼å®šä¹‰
log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                '$status $body_bytes_sent "$http_referer" '
                '"$http_user_agent" "$http_x_forwarded_for" '
                'rt=$request_time uct="$upstream_connect_time" '
                'uht="$upstream_header_time" urt="$upstream_response_time"';

# è®¿é—®æ—¥å¿—
access_log /var/log/nginx/access.log main;

# é”™è¯¯æ—¥å¿—
error_log /var/log/nginx/error.log warn;
```

### æ—¥å¿—è½®è½¬
```bash
# /etc/logrotate.d/personal-blog
/app/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    postrotate
        docker-compose exec app kill -USR1 1
    endscript
}
```

### æ—¥å¿—åˆ†æ

#### ä½¿ç”¨ELK Stack
```yaml
# docker-compose.logging.yml
version: '3.8'

services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:7.15.0
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    ports:
      - "9200:9200"
    volumes:
      - elasticsearch_data:/usr/share/elasticsearch/data

  logstash:
    image: docker.elastic.co/logstash/logstash:7.15.0
    ports:
      - "5044:5044"
    volumes:
      - ./logging/logstash.conf:/usr/share/logstash/pipeline/logstash.conf

  kibana:
    image: docker.elastic.co/kibana/kibana:7.15.0
    ports:
      - "5601:5601"
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200

volumes:
  elasticsearch_data:
```

#### ä½¿ç”¨Grafana Loki
```yaml
# docker-compose.loki.yml
version: '3.8'

services:
  loki:
    image: grafana/loki:latest
    ports:
      - "3100:3100"
    volumes:
      - ./loki/loki.yml:/etc/loki/local-config.yaml
    command: -config.file=/etc/loki/local-config.yaml

  promtail:
    image: grafana/promtail:latest
    volumes:
      - ./promtail/promtail.yml:/etc/promtail/config.yml
      - /app/logs:/var/log/app
    command: -config.file=/etc/promtail/config.yml
```

## æ•…éšœæ’æŸ¥

### æ•…éšœæ’æŸ¥æµç¨‹

#### 1. é—®é¢˜è¯†åˆ«
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps

# æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
uptime
top

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping yourdomain.com
curl -I http://localhost:3000
```

#### 2. æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f app

# æŸ¥çœ‹Nginxæ—¥å¿—
docker-compose logs -f nginx

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs -f db

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
sudo journalctl -f
```

#### 3. æ€§èƒ½åˆ†æ
```bash
# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
ps aux
pstree

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -tulpn
ss -tulpn

# æŸ¥çœ‹æ–‡ä»¶æè¿°ç¬¦
lsof -i
```

#### 4. èµ„æºç›‘æ§
```bash
# å®æ—¶ç›‘æ§
htop
iotop
iftop

# ç³»ç»Ÿç»Ÿè®¡
vmstat 1
iostat 1
sar 1
```

### å¸¸è§æ•…éšœåœºæ™¯

#### åº”ç”¨æ— å“åº”
```bash
# æ’æŸ¥æ­¥éª¤
1. æ£€æŸ¥åº”ç”¨è¿›ç¨‹çŠ¶æ€
   docker-compose ps app

2. æ£€æŸ¥åº”ç”¨æ—¥å¿—
   docker-compose logs app

3. æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tulpn | grep 3000

4. æ£€æŸ¥èµ„æºä½¿ç”¨
   docker stats

5. é‡å¯åº”ç”¨
   docker-compose restart app
```

#### æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ’æŸ¥æ­¥éª¤
1. æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
   docker-compose ps db

2. æµ‹è¯•æ•°æ®åº“è¿æ¥
   docker-compose exec db pg_isready

3. æ£€æŸ¥è¿æ¥æ•°
   docker-compose exec db psql -U postgres -c "SELECT count(*) FROM pg_stat_activity;"

4. æ£€æŸ¥æ•°æ®åº“æ—¥å¿—
   docker-compose logs db

5. é‡å¯æ•°æ®åº“
   docker-compose restart db
```

#### ç½‘ç»œé—®é¢˜
```bash
# æ’æŸ¥æ­¥éª¤
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
   ping 8.8.8.8

2. æ£€æŸ¥DNSè§£æ
   nslookup yourdomain.com

3. æ£€æŸ¥ç«¯å£å¼€æ”¾
   telnet localhost 3000

4. æ£€æŸ¥é˜²ç«å¢™
   sudo ufw status

5. æ£€æŸ¥Nginxé…ç½®
   docker-compose exec nginx nginx -t
```

### æ€§èƒ½é—®é¢˜æ’æŸ¥

#### å“åº”æ—¶é—´æ…¢
```bash
# åˆ†æå“åº”æ—¶é—´
curl -w "@curl-format.txt" -o /dev/null -s http://localhost:3000

# æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢
docker-compose exec db psql -U postgres -c "
SELECT query, mean_time, calls
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;"

# æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
docker-compose exec redis redis-cli info stats | grep keyspace
```

#### å†…å­˜ä½¿ç”¨è¿‡é«˜
```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
docker stats

# åˆ†æè¿›ç¨‹å†…å­˜
ps aux --sort=-%mem | head

# æ£€æŸ¥Node.jså†…å­˜
docker-compose exec app node -e "console.log(process.memoryUsage())"
```

#### CPUä½¿ç”¨è¿‡é«˜
```bash
# æ£€æŸ¥CPUä½¿ç”¨
top
htop

# åˆ†æè¿›ç¨‹CPU
ps aux --sort=-%cpu | head

# æ£€æŸ¥ç³»ç»Ÿè°ƒç”¨
strace -p <PID>
```

### è‡ªåŠ¨åŒ–æ•…éšœå¤„ç†

#### è‡ªåŠ¨é‡å¯è„šæœ¬
```bash
#!/bin/bash
# scripts/auto-recovery.sh

check_and_restart() {
    local service="$1"
    local health_url="$2"

    if ! curl -f "$health_url" >/dev/null 2>&1; then
        echo "æœåŠ¡ $service å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œå°è¯•é‡å¯..."
        docker-compose restart "$service"
        sleep 30

        if curl -f "$health_url" >/dev/null 2>&1; then
            echo "æœåŠ¡ $service é‡å¯æˆåŠŸ"
            # å‘é€æ¢å¤é€šçŸ¥
            send_notification "æœåŠ¡ $service å·²è‡ªåŠ¨æ¢å¤"
        else
            echo "æœåŠ¡ $service é‡å¯å¤±è´¥ï¼Œéœ€è¦äººå·¥å¹²é¢„"
            # å‘é€å‘Šè­¦é€šçŸ¥
            send_alert "æœåŠ¡ $service è‡ªåŠ¨æ¢å¤å¤±è´¥"
        fi
    fi
}

# æ£€æŸ¥å…³é”®æœåŠ¡
check_and_restart "app" "http://localhost:3000/api/health"
check_and_restart "nginx" "http://localhost/health"
```

#### ç›‘æ§è„šæœ¬å®šæ—¶ä»»åŠ¡
```bash
# æ·»åŠ åˆ°crontab
# æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æœåŠ¡çŠ¶æ€
*/5 * * * * /opt/personal-blog/scripts/monitoring/app-monitor.sh

# æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡ç³»ç»Ÿèµ„æº
0 * * * * /opt/personal-blog/scripts/monitoring/system-monitor.sh

# æ¯å¤©æ£€æŸ¥ä¸€æ¬¡ç£ç›˜ç©ºé—´
0 2 * * * /opt/personal-blog/scripts/monitoring/disk-monitor.sh
```

---

**æ³¨æ„**: ç›‘æ§ç³»ç»Ÿæœ¬èº«ä¹Ÿä¼šæ¶ˆè€—èµ„æºï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ç›‘æ§é¢‘ç‡å’Œç²’åº¦ã€‚